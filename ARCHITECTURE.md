# ğŸ—ï¸ ë°í¬ ê²¬ì ê¸° ì•„í‚¤í…ì²˜

## ê°œìš”

ë°í¬ ê²¬ì ê¸°ëŠ” **ëª¨ë…¸ë ˆí¬ êµ¬ì¡°**ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ, ë°í¬ ì‹œê³µì— í•„ìš”í•œ ìì¬ ìˆ˜ëŸ‰ì„ ê³„ì‚°í•˜ê³  ì¬ë‹¨ ê³„íšì„ ìƒì„±í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤                        â”‚
â”‚                      (apps/web - React)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§                          â”‚
â”‚                   (packages/core - TypeScript)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ë°ì´í„° ë ˆì´ì–´                           â”‚
â”‚              (products.json, ruleset.*.json)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
deck-estimator-app/
â”œâ”€â”€ ğŸ“¦ apps/
â”‚   â””â”€â”€ web/                    # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ components/     # UI ì»´í¬ë„ŒíŠ¸
â”‚           â”‚   â”œâ”€â”€ deck-canvas/    # ìº”ë²„ìŠ¤ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸
â”‚           â”‚   â”œâ”€â”€ DeckCanvas.tsx  # ë©”ì¸ SVG ìº”ë²„ìŠ¤
â”‚           â”‚   â”œâ”€â”€ ControlsPanel.tsx   # ì¢Œì¸¡ ì„¤ì • íŒ¨ë„
â”‚           â”‚   â”œâ”€â”€ ResultsPanel.tsx    # ê²°ê³¼ í‘œì‹œ íŒ¨ë„
â”‚           â”‚   â””â”€â”€ FreeDrawCanvas.tsx  # ììœ í˜• ê·¸ë¦¬ê¸°
â”‚           â”œâ”€â”€ hooks/          # React ì»¤ìŠ¤í…€ í›…
â”‚           â”‚   â”œâ”€â”€ useDeckProject.ts   # í”„ë¡œì íŠ¸ ìƒíƒœ ê´€ë¦¬
â”‚           â”‚   â”œâ”€â”€ useCanvasViewport.ts    # ìº”ë²„ìŠ¤ ë·°í¬íŠ¸
â”‚           â”‚   â””â”€â”€ useHistory.ts       # Undo/Redo
â”‚           â”œâ”€â”€ geometry/       # í´ë¼ì´ì–¸íŠ¸ ì§€ì˜¤ë©”íŠ¸ë¦¬ ìœ í‹¸
â”‚           â”œâ”€â”€ constants/      # ê¸°ë³¸ê°’, í”„ë¦¬ì…‹
â”‚           â”œâ”€â”€ utils/          # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚           â”œâ”€â”€ i18n/           # ë‹¤êµ­ì–´ (í˜„ì¬ í•œêµ­ì–´)
â”‚           â””â”€â”€ types.ts        # í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ì •ì˜
â”‚
â”œâ”€â”€ ğŸ“¦ packages/
â”‚   â””â”€â”€ core/                   # ìˆœìˆ˜ TypeScript ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ calculateQuantities.ts  # ğŸ”¢ ìˆ˜ëŸ‰ ê³„ì‚° ì—”ì§„
â”‚           â”œâ”€â”€ calculateStairs.ts      # ğŸªœ ê³„ë‹¨ ê³„ì‚°
â”‚           â”œâ”€â”€ cutPlan.ts              # âœ‚ï¸ ì¬ë‹¨ ê³„íš (Pro)
â”‚           â”œâ”€â”€ geometry.ts             # ğŸ“ ê¸°í•˜í•™ ì—°ì‚°
â”‚           â”œâ”€â”€ types.ts                # íƒ€ì… ì •ì˜
â”‚           â””â”€â”€ index.ts                # ëª¨ë“ˆ export
â”‚
â”œâ”€â”€ ğŸ“„ products.json            # ì œí’ˆ ë°ì´í„°
â”œâ”€â”€ ğŸ“„ ruleset.consumer.json    # ì¼ë°˜ ëª¨ë“œ ê·œì¹™
â”œâ”€â”€ ğŸ“„ ruleset.pro.json         # ì „ë¬¸ê°€ ëª¨ë“œ ê·œì¹™
â”œâ”€â”€ ğŸ“„ SPEC.md                  # ê¸°ëŠ¥ ëª…ì„¸ (PRD)
â”œâ”€â”€ ğŸ“„ DEVELOPMENT_GUIDELINES.md    # ê°œë°œ ì§€ì¹¨ì„œ
â””â”€â”€ ğŸ“„ CLAUDE.md                # AI ì»¨í…ìŠ¤íŠ¸
```

---

## í•µì‹¬ ëª¨ë“ˆ

### 1. @deck/core (packages/core)

**ìˆœìˆ˜ TypeScript ë¼ì´ë¸ŒëŸ¬ë¦¬** - UI ì˜ì¡´ì„± ì—†ìŒ, í…ŒìŠ¤íŠ¸ ìš©ì´

```typescript
// ì£¼ìš” export
export { calculateQuantities } from "./calculateQuantities.js";
export { buildCutPlan } from "./cutPlan.js";
export { calculateStairs } from "./calculateStairs.js";
export * from "./geometry.js";
export * from "./types.js";
```

#### calculateQuantities.ts

```
ì…ë ¥: Plan, Product, Ruleset, FasteningMode
ì¶œë ¥: Quantities (ë©´ì , ë³´ë“œ, í•˜ë¶€êµ¬ì¡°, íŒ¨ìŠ¤ë„ˆ, ê³„ë‹¨ ë“±)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Plan     â”‚ â”€â”€â–¶ â”‚ calculateQuantities â”‚ â”€â”€â–¶ â”‚   Quantities   â”‚
â”‚  (polygon)  â”‚     â”‚                     â”‚     â”‚ (area, boards, â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚  - ë©´ì  ê³„ì‚°         â”‚     â”‚  substructure, â”‚
â”‚   Product   â”‚ â”€â”€â–¶ â”‚  - ë³´ë“œ ìˆ˜ëŸ‰         â”‚     â”‚  fasteners...) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚  - í•˜ë¶€êµ¬ì¡°          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   Ruleset   â”‚ â”€â”€â–¶ â”‚  - íŒ¨ìŠ¤ë„ˆ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  - ê³„ë‹¨             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### cutPlan.ts (Pro ëª¨ë“œ ì „ìš©)

```
ì…ë ¥: Polygon, Product, Ruleset, boardWidthMm, deckingDirectionDeg
ì¶œë ¥: CutPlan (ì¬ë‹¨ ê³„íš, ì˜¤í”„ì»· ì¬ì‚¬ìš©)

ì•Œê³ ë¦¬ì¦˜: Best-Fit Bin Packing
- ê° ë³´ë“œ ë¼ì¸ì— í•„ìš”í•œ ê¸¸ì´ ê³„ì‚°
- ì¬ê³  ê¸¸ì´ì—ì„œ ìµœì  ë°°ì¹˜
- ì˜¤í”„ì»·(ìíˆ¬ë¦¬) ì¬ì‚¬ìš© ìµœì í™”
```

### 2. apps/web (React í”„ë¡ íŠ¸ì—”ë“œ)

**Vite + React + TypeScript**

#### ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ

```
App.tsx
â”œâ”€â”€ ControlsPanel.tsx       # ì¢Œì¸¡: ì„¤ì • ì…ë ¥
â”‚   â”œâ”€â”€ í‰ë©´ë„ ì„¹ì…˜ (shape selection)
â”‚   â”œâ”€â”€ ê°œêµ¬ë¶€ ì„¹ì…˜ (cutouts)
â”‚   â”œâ”€â”€ ê³„ë‹¨ ì„¹ì…˜
â”‚   â”œâ”€â”€ ì¸¡ë©´ ì„¹ì…˜ (wall attachment)
â”‚   â”œâ”€â”€ ë°í¬ì¬ ì„¹ì…˜
â”‚   â”œâ”€â”€ ì‹œê³µ ì˜µì…˜ ì„¹ì…˜
â”‚   â””â”€â”€ í•˜ë¶€ êµ¬ì¡° ì„¹ì…˜
â”‚
â”œâ”€â”€ DeckCanvas.tsx          # ì¤‘ì•™: ì¸í„°ë™í‹°ë¸Œ SVG
â”‚   â”œâ”€â”€ DeckPolygon.tsx         # í´ë¦¬ê³¤ ë Œë”ë§
â”‚   â”œâ”€â”€ DeckGrid.tsx            # í•˜ë¶€êµ¬ì¡° ê·¸ë¦¬ë“œ
â”‚   â”œâ”€â”€ DeckBoardPattern.tsx    # ë³´ë“œ íŒ¨í„´
â”‚   â”œâ”€â”€ DeckVertexHandles.tsx   # ê¼­ì§“ì  í•¸ë“¤
â”‚   â”œâ”€â”€ DeckEdgeControls.tsx    # ë³€ ì¡°ì ˆ
â”‚   â””â”€â”€ DeckHoles.tsx           # ê°œêµ¬ë¶€
â”‚
â”œâ”€â”€ FreeDrawCanvas.tsx      # ììœ í˜• ê·¸ë¦¬ê¸° ëª¨ë“œ
â”‚
â””â”€â”€ ResultsPanel.tsx        # ìš°ì¸¡: ê²°ê³¼ í‘œì‹œ
    â””â”€â”€ CutPlanView.tsx         # ì¬ë‹¨ ê³„íš ì‹œê°í™”
```

#### ìƒíƒœ ê´€ë¦¬

```
useDeckProject (ë©”ì¸ ìƒíƒœ í›…)
â”œâ”€â”€ plan: Plan              # í´ë¦¬ê³¤, ì„¤ì • ë°ì´í„°
â”œâ”€â”€ cutoutsMeta: CutoutMeta[]   # ê°œêµ¬ë¶€ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ shapeType: ShapeType    # í˜„ì¬ ë„í˜• íƒ€ì…
â””â”€â”€ actions
    â”œâ”€â”€ setPlan()
    â”œâ”€â”€ updatePolygon()
    â”œâ”€â”€ addCutout()
    â”œâ”€â”€ deleteCutout()
    â””â”€â”€ ...

useHistory (Undo/Redo)
â”œâ”€â”€ history: HistoryState[]
â”œâ”€â”€ historyIndex: number
â”œâ”€â”€ canUndo / canRedo
â””â”€â”€ undo() / redo()
```

---

## ë°ì´í„° íë¦„

### 1. ìˆ˜ëŸ‰ ê³„ì‚° íë¦„

```
ì‚¬ìš©ì ì…ë ¥ (UI)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ControlsPanel  â”‚  ë„í˜• ì„ íƒ, ì¹˜ìˆ˜ ì…ë ¥, ì˜µì…˜ ì„¤ì •
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  useDeckProject â”‚  ìƒíƒœ ì—…ë°ì´íŠ¸ (plan)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ calculateQuant. â”‚  @deck/coreì—ì„œ ìˆ˜ëŸ‰ ê³„ì‚°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResultsPanel   â”‚  ê²°ê³¼ í‘œì‹œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. í´ë¦¬ê³¤ í¸ì§‘ íë¦„

```
DeckCanvas (SVG)
      â”‚
      â”œâ”€â”€ ê¼­ì§“ì  ë“œë˜ê·¸ â”€â”€â–¶ updateVertex()
      â”‚
      â”œâ”€â”€ ë³€ ë“œë˜ê·¸ â”€â”€â”€â”€â”€â”€â–¶ updateEdgeLength()
      â”‚
      â”œâ”€â”€ ê¼­ì§“ì  ì¶”ê°€ â”€â”€â”€â”€â–¶ addVertex()
      â”‚
      â””â”€â”€ ê¼­ì§“ì  ì‚­ì œ â”€â”€â”€â”€â–¶ deleteVertex()
                              â”‚
                              â–¼
                      onChangePolygon()
                              â”‚
                              â–¼
                      useDeckProject.updatePolygon()
```

---

## íƒ€ì… ì‹œìŠ¤í…œ

### Core íƒ€ì… (packages/core/src/types.ts)

```typescript
// ê¸°ë³¸ ì§€ì˜¤ë©”íŠ¸ë¦¬
type Point = { xMm: number; yMm: number };
type Polygon = { outer: Point[]; holes?: Point[][] };

// ê³„íš ë°ì´í„°
type Plan = {
  polygon: Polygon;
  layoutRotationDeg: number;
  deckingDirectionDeg: number;
  attachedEdgeIndices: number[];
  fasciaEdgeIndices: number[];
  stairs?: StairsConfig;
  // ... ê¸°íƒ€ ì˜µì…˜
};

// ì œí’ˆ ì •ë³´
type Product = {
  id: string;
  name: string;
  stockLengthMm: number;
  widthOptionsMm: number[];
  thicknessMm: number;
  gapMm: number;
  fasteningModes: FasteningMode[];
};

// ê·œì¹™ì…‹
type Ruleset = {
  mode: "consumer" | "pro";
  secondarySpacingMm: number;
  primarySpacingMm: number;
  consumerLoss: { base: number; vertexFactor: number; ... };
  // ...
};

// ê³„ì‚° ê²°ê³¼
type Quantities = {
  areaMm2: number;
  areaM2: number;
  boardCount: number;
  boardLengthMm: number;
  // ... í•˜ë¶€êµ¬ì¡°, íŒ¨ìŠ¤ë„ˆ ë“±
};
```

### í´ë¼ì´ì–¸íŠ¸ íƒ€ì… (apps/web/src/types.ts)

```typescript
type ShapeType = "rectangle" | "lShape" | "tShape" | "free" | "circle";
type CutoutShape = "rectangle" | "free" | "circle";
type PlanPoint = { xMm: number; yMm: number };
```

---

## ëª¨ë“œë³„ ê¸°ëŠ¥

### Consumer ëª¨ë“œ (ì¼ë°˜)

- ê¸°ë³¸ ìˆ˜ëŸ‰ ê³„ì‚°
- ì†ì‹¤ë¥  ìë™ ì ìš© (3~6%)
- ê°„ì†Œí™”ëœ UI

### Pro ëª¨ë“œ (ì „ë¬¸ê°€)

- ìƒì„¸ ìˆ˜ëŸ‰ ê³„ì‚°
- ì¬ë‹¨ ê³„íš (Cut Plan) ìƒì„±
- ì˜¤í”„ì»· ì¬ì‚¬ìš© ìµœì í™”
- ê³ ê¸‰ ì˜¤ë²„ë¼ì´ë“œ ì˜µì…˜

---

## ë¹Œë“œ ë° ì˜ì¡´ì„±

### ë¹Œë“œ ìˆœì„œ (ì¤‘ìš”!)

```bash
1. packages/core ë¹Œë“œ    â†’    dist/*.js, dist/*.d.ts
         â”‚
         â–¼
2. apps/web ë¹Œë“œ/ì‹¤í–‰    â†’    import from "@deck/core"
```

### ì˜ì¡´ì„± ê·¸ë˜í”„

```
apps/web
    â”‚
    â”œâ”€â”€ @deck/core (ë¡œì»¬ íŒ¨í‚¤ì§€)
    â”‚       â”‚
    â”‚       â””â”€â”€ (ì˜ì¡´ì„± ì—†ìŒ - ìˆœìˆ˜ TypeScript)
    â”‚
    â”œâ”€â”€ react, react-dom
    â””â”€â”€ vite (ê°œë°œ/ë¹Œë“œ)
```

---

## í™•ì¥ í¬ì¸íŠ¸

### ìƒˆ ë„í˜• ì¶”ê°€

1. `types.ts`ì— ShapeType ì¶”ê°€
2. `constants/defaults.ts`ì— í”„ë¦¬ì…‹ ì¶”ê°€
3. `useDeckProject.ts`ì— ë³€í™˜ ë¡œì§ ì¶”ê°€

### ìƒˆ ê³„ì‚° í•­ëª© ì¶”ê°€

1. `packages/core/src/types.ts`ì— Quantities í•„ë“œ ì¶”ê°€
2. `calculateQuantities.ts`ì— ê³„ì‚° ë¡œì§ ì¶”ê°€
3. `ResultsPanel.tsx`ì— í‘œì‹œ UI ì¶”ê°€

### ìƒˆ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

1. `src/components/`ì— ì»´í¬ë„ŒíŠ¸ ìƒì„±
2. í•„ìš”ì‹œ `deck-canvas/`ì— ì„œë¸Œì»´í¬ë„ŒíŠ¸ ì¶”ê°€
3. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ import ë° ì‚¬ìš©

---

## ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### ë Œë”ë§ ìµœì í™”

- `React.memo()` ì‚¬ìš© (DeckBoardPattern, ToggleSwitch ë“±)
- `useMemo()` / `useCallback()` ì ê·¹ í™œìš©
- SVG ìš”ì†Œ ìµœì†Œí™”

### ê³„ì‚° ìµœì í™”

- í´ë¦¬ê³¤ ë³€ê²½ ì‹œì—ë§Œ ì¬ê³„ì‚°
- `useMemo`ë¡œ ê³„ì‚° ê²°ê³¼ ìºì‹±
- ë¬´ê±°ìš´ ê³„ì‚°ì€ debounce ì ìš©

---

## í…ŒìŠ¤íŠ¸

### Core íŒ¨í‚¤ì§€

```bash
cd packages/core
npm test
```

- `calculateQuantities.test.ts` - ìˆ˜ëŸ‰ ê³„ì‚° ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸
- `smoke.test.ts` - ê¸°ë³¸ ë™ì‘ í…ŒìŠ¤íŠ¸

### ê¶Œì¥ í…ŒìŠ¤íŠ¸ ì¶”ê°€

- ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ (React Testing Library)
- E2E í…ŒìŠ¤íŠ¸ (Playwright)

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ       | ë²„ì „ | ë³€ê²½ ë‚´ìš©      |
| ---------- | ---- | -------------- |
| 2026-01-02 | 1.0  | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± |
